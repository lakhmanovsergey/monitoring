<!doctype html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<style type="text/css">
td, th { border: 1px solid #c3c3c3; padding: 0 3px 0 3px; }
table { border-collapse: collapse; }
img { max-width: 100%; }
</style>
<meta name="generator" content="ReText 7.2.3">
<title>README</title>
<style type="text/css">
</style>
</head>
<body>
<h3>Система мониторинга</h3>
<h4>Объекты мониторинга:</h4>
<ol>
<li>Ядро сети</li>
<li>Маршрутизатор ядра сети Mikrotik RB1100AHx4 172.24.0.1 (SNMP)</li>
<li>Сервер АСИ 172.24.95.201 (node_exporter)</li>
<li>Сервер АСИ 172.24.95.202 (node_exporter)</li>
<li>Сервер АСИ 172.24.95.201 (IPMI)</li>
<li>Сервер АСИ 172.24.95.202 (IPMI)</li>
<li>Доступность и качество связи до судов (ping)</li>
<li>Вышка Раскат</li>
<li>Маршрутизатор Mikrotik RBD53GR 172.24.98.1 (SNMP)</li>
<li>Коммутатор Planet GS-5220-24P4XV 172.24.98.2 (SNMP)</li>
<li>ИБП Smart-UPS 5000 172.24.98.6 (SNMP) </li>
<li>Сетевое хранилище Synology NAS DS418 172.24.98.51 (SNMP)</li>
<li>Сервер ОСА 172.24.98.101 (node_exporter)</li>
<li>Видеокарта NVIDIA GeForce RTX 3090 на сервере ОСА (nvidia-gpu-exporter)</li>
<li>Суда и ДПУ<ol>
<li>Росморпорт</li>
<li>Маршрутизатор RB1100AHx4 192.168.120.1 (SNMP)</li>
<li>Маршрутизатор LtAP LTE kit 172.16.120.1 (SNMP)</li>
<li>Сервер АНС 192.168.120.201 (node_exporter)</li>
<li>Сервер АНС-Клиент 192.168.120.202 (node_exporter)</li>
<li>Сервер АНС 192.168.120.201 (S.M.A.R.T)</li>
<li>Сервер АНС-Клиент 192.168.120.202 (S.M.A.R.T)</li>
<li>Сервер АНС 192.168.120.201 (IPMI)</li>
<li>Сервер АНС-Клиент 192.168.120.202 (IPMI)</li>
<li>Сервер ОСА 192.168.120.101 (prometheus)</li>
<li>ИБП Smart-UPS SRT 3000 192.168.120.6 (SNMP)</li>
<li>ИБП Smart-UPS SRT 3000 192.168.120.7 (SNMP)</li>
<li>Пола Райс</li>
<li>Сервер АНС-Клиент в офисе 192.168.131.202 (SNMP с ядра)</li>
<li>Маршрутизатор RB1100AHx4 192.168.130.1 (SNMP)</li>
<li>Сервер АНС 192.168.130.201 (node_exporter)</li>
<li>Сервер АНС-Клиент 192.168.130.202 (node_exporter)</li>
<li>Сервер АНС 192.168.130.201 (S.M.A.R.T)</li>
<li>Сервер АНС-Клиент 192.168.130.202 (S.M.A.R.T)</li>
<li>Сервер АНС 192.168.130.201 (IPMI)</li>
<li>Сервер АНС-Клиент 192.168.130.202 (IPMI)</li>
<li>ИБП Smart-UPS SRT 3000 192.168.130.6 (SNMP)</li>
<li>ИБП Smart-UPS SRT 3000 192.168.130.7 (SNMP)</li>
<li>Совкомфлот</li>
<li>Маршрутизатор RB1100AHx4 192.168.140.1 (SNMP)</li>
<li>Сервер АНС 192.168.140.201 (node_exporter)</li>
<li>Сервер АНС-Клиент 192.168.140.202 (node_exporter)</li>
<li>Сервер АНС 192.168.140.201 (S.M.A.R.T)</li>
<li>Сервер АНС-Клиент 192.168.140.202 (S.M.A.R.T)</li>
<li>Сервер АНС 192.168.140.201 (IPMI)</li>
<li>Сервер АНС-Клиент 192.168.140.202 (IPMI)</li>
<li>ИБП Smart-UPS SRT 3000 192.168.140.6 (SNMP)</li>
<li>ИБП Smart-UPS SRT 3000 192.168.140.7 (SNMP)</li>
</ol>
</li>
</ol>
<h4>Инфраструктура</h4>
<ol>
<li>Репозиторий</li>
<li>Адрес: https://gitlab.ops.steor.ru/bskf/anav-monitoring</li>
<li>Ветки:<ul>
<li>core: Настройки мониторинга ядра сети + Gragana + ping </li>
<li>shalanda: Настройки prometheus + snmp + ipmi + loki</li>
<li>Anfisa: Настройки prometheus + snmp + ipmi + loki</li>
<li>Ulianov: Настройки prometheus + snmp + ipmi + loki</li>
<li>testing: Настройки prometheus + snmp + ipmi + loki</li>
</ul>
</li>
<li>Адреса установки</li>
<li>core: 172.24.0.65</li>
<li>shalanda: 192.168.120.8 (проверил возможность работы докера на Windows)</li>
<li>Anfisa: 192.168.130.202</li>
<li>Ulianov: 192.168.140.202</li>
</ol>
<h4>Интерфейс</h4>
<ol>
<li>Доступ</li>
<li>url: http://172.24.0.65:3000</li>
<li>login:admin, password:бэсовский</li>
<li>Папки дашбордов</li>
<li>General: Устанавливаемые по умолчанию дашборбы</li>
<li>anav: Дашборды ядра сети<ul>
<li>anav Nodes: мониторинг хостов Линукс, удаленные хосты собираются с помощью federation, если связи нет, данные с удаленных хостов не идут</li>
<li>APC UPS (SNMP) Core: мониторинг бесперебойников по SNMP, удаленные - через federation</li>
<li>IPMI Exporter: мониторинг серверов через IPMI</li>
<li>Logs/App: сбор логов </li>
<li>Mikrotik Monitoring SNMP: мониторинг микротиков по SNMP</li>
<li>Node Exporter Full: Подробный мониторинг Линукс хостов</li>
<li>Ping Probes: выдаются пинги раз в 10 с, подсчитывается процент потерь, время ответа</li>
<li>S.M.A.R.T. monitoring core: мониторятся диски по S.M.A.R.T.</li>
</ul>
</li>
<li>raskat: Дашборды РТП Раскат<ul>
<li>Node Exporter Full: Подробный мониторинг Линукс хостов, с ОСы данные берутся с местного Prometheus через federation</li>
<li>Nut Status: мониторинг ИБП посредством NUT</li>
<li>SNMP Stats: мониторинг интерфейсов по SNMP, используется для мониторинга свича</li>
<li>Nvidia GPU Metrics: данные с видеокарты</li>
<li>Synology NAS Details: данные с Synology по SNMP</li>
</ul>
</li>
<li>shalanda:<ul>
<li>IPMI Exporter: мониторинг серверов через IPMI</li>
<li>Mikrotik Monitoring SNMP: мониторинг микротиков по SNMP, на 172.16.120.1 есть данные с LTE</li>
<li>Node Exporter Full: Подробный мониторинг Линукс хостов </li>
<li>S.M.A.R.T. monitoring core: мониторятся диски по S.M.A.R.T.</li>
<li>APC UPS (SNMP): мониторинг бесперебойников по SNMP</li>
</ul>
</li>
<li>anfisa:<ul>
<li>IPMI Exporter: мониторинг серверов через IPMI</li>
<li>Mikrotik Monitoring SNMP: мониторинг микротиков по SNMP</li>
<li>Node Exporter Full: Подробный мониторинг Линукс хостов </li>
<li>S.M.A.R.T. monitoring core: мониторятся диски по S.M.A.R.T.</li>
<li>APC UPS (SNMP): мониторинг бесперебойников по SNMP</li>
</ul>
</li>
<li>ulianov:<ul>
<li>IPMI Exporter: мониторинг серверов через IPMI</li>
<li>Mikrotik Monitoring SNMP: мониторинг микротиков по SNMP</li>
<li>Node Exporter Full: Подробный мониторинг Линукс хостов </li>
<li>S.M.A.R.T. monitoring core: мониторятся диски по S.M.A.R.T.</li>
<li>APC UPS (SNMP): мониторинг бесперебойников по SNMP</li>
</ul>
</li>
<li>enav:<ul>
<li>SSL/TLS Exporter: Срок истечения сертификатов</li>
</ul>
</li>
</ol>
<h3>Инсталляция</h3>
<p>Система работает в Docker, необходимо, чтобы он был установлен в системе, тестировалось с <code>Docker version 20.10.5+dfsg1</code>, <code>Docker version 20.10.21</code> на <code>Debian 11.3</code>, <code>Ubuntu 20.04.4 LTS</code>, <code>Windows 10</code>. Образа контейнеров тянутся с докерхаба, поэтому нужен Интернет. Порядок установки:</p>
<ol>
<li>В системе должен быть установлен Докер</li>
<li>Если есть GIT, должен быть доступ к репозиторию <code>https://gitlab.ops.steor.ru</code>, если доступа нет или нежелательно устанавливать GIT, то копируем со своего компьютера с помощью rsync <code>rsync -a ./* user@172.24.0.65:monitoring/dockprom/</code>, заранее перейдя в каталог репозитория и выбрав нужную ветку</li>
<li>Клонируем репозиторий <code>git clone git@gitlab.ops.steor.ru:bskf/anav-monitoring.git</code></li>
<li>Выбираем нужную ветку </li>
<li><code>git checkout core</code> - ядро</li>
<li><code>git checkout shalanda</code> - Шаланда</li>
<li><code>git checkout anfisa</code> - Анфиса</li>
<li><code>git checkout ulianov</code> - Ульянов</li>
<li>Тянем, собираем, запускаем <code>docker up -d</code></li>
<li>На хосты с Linux устанавливаем node_exporter, snmp, на оборудовании в сети должен быть настроен SNMP с соответствующим community, IPMI на серверах также должен быть доступен</li>
</ol>

</body>
</html>
